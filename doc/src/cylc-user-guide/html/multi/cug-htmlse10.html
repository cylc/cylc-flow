<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"  
  "http://www.w3.org/TR/html4/loose.dtd">  
<html > 
<head><title>Task Implementation</title> 
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
<meta name="generator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<meta name="originator" content="TeX4ht (http://www.tug.org/tex4ht/)"> 
<!-- html,fn-in,2,next --> 
<meta name="src" content="cug-html.tex"> 
<link rel="stylesheet" type="text/css" href="cug-html.css"> 
</head><body 
>
<!--l. 5619--><div class="crosslinks"><p class="noindent">[<a 
href="cug-htmlse11.html" >next</a>] [<a 
href="cug-htmlse9.html" >prev</a>] [<a 
href="cug-htmlse9.html#tailcug-htmlse9.html" >prev-tail</a>] [<a 
href="#tailcug-htmlse10.html">tail</a>] [<a 
href="cug-html.html#cug-htmlse10.html" >up</a>] </p></div>
<!--l. 5619--><p class="noindent" > <h3 id="10" class="sectionHead"><span class="titlemark"> <a href="#10">10</a>  <a 
 id="x12-16400010"></a>Task Implementation </span></h3> <div class="sectionTOCS">
&#x00A0;<span class="subsectionToc" >10.1 <a 
href="#x12-16500010.1">Task Job Scripts</a></span>
<br />&#x00A0;<span class="subsectionToc" >10.2 <a 
href="#x12-16600010.2">Inlined Tasks</a></span>
<br />&#x00A0;<span class="subsectionToc" >10.3 <a 
href="#x12-16700010.3">Task Messages</a></span>
<br />&#x00A0;<span class="subsectionToc" >10.4 <a 
href="#x12-16800010.4">Aborting Job Scripts on Error</a></span>
<br />&#x00A0;<span class="subsectionToc" >10.5 <a 
href="#x12-17000010.5">Avoid Detaching Processes</a></span>
</div>
<!--l. 5622--><p class="noindent" >Existing scripts and executables can be used as cylc tasks without modification so long as they return standard
exit status - zero on success, non-zero for failure - and do not spawn detaching processes internally
(see&#x00A0;<a 
href="#x12-17000010.5">10.5<!--tex4ht:ref: DetachingJobs --></a>).
<!--l. 5627--><p class="noindent" >
<!--l. 5627--><p class="noindent" > <h4 id="10.1" class="subsectionHead"> <span class="titlemark"> <a href="#10.1"> 10.1</a>  <a 
 id="x12-16500010.1"></a>Task Job Scripts </span></h4>
<!--l. 5630--><p class="noindent" >When the suite dameon determines that a task is ready to run it generates a <span 
class="cmti-10">job script </span>that embodies the task
runtime configuration in the suite.rc file, and submits it to the configured job host and batch system
(see&#x00A0;<a 
href="cug-htmlse11.html#x13-17100011">11<!--tex4ht:ref: TaskJobSubmission --></a>).
<!--l. 5635--><p class="noindent" >Task job scripts are written to the suite&#8217;s job log directory. They can be printed with <span class="lstinline"></span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">cat</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">log</span> or generated
and printed with <span class="lstinline"></span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">jobscript</span>.
<!--l. 5639--><p class="noindent" >
<!--l. 5639--><p class="noindent" > <h4 id="10.2" class="subsectionHead"> <span class="titlemark"> <a href="#10.2"> 10.2</a>  <a 
 id="x12-16600010.2"></a>Inlined Tasks </span></h4>
<!--l. 5641--><p class="noindent" >Task <span 
class="cmti-10">script </span>items can be multi-line strings of <span class="lstinline"></span><span 
class="pcrr7t-">bash</span> code, so many tasks can be entirely inlined in the suite.rc file.
For anything more than a few lines of code, however, we recommend using external shell scripts to allow
independent testing, re-use, and shell mode editing.
                                                                                         

                                                                                         
<!--l. 5646--><p class="noindent" >
<!--l. 5646--><p class="noindent" > <h4 id="10.3" class="subsectionHead"> <span class="titlemark"> <a href="#10.3"> 10.3</a>  <a 
 id="x12-16700010.3"></a>Task Messages </span></h4>
<!--l. 5648--><p class="noindent" >Tasks messages can be sent back to the suite server program to report completed outputs and arbitrary messages of
different severity levels.
<!--l. 5651--><p class="noindent" >Some types of message - in addition to events like task failure - can optionally trigger execution of event handlers in
the suite server program (see&#x00A0;<a 
href="cug-htmlse13.html#x15-23900013.19">13.19<!--tex4ht:ref: EventHandling --></a>).
<!--l. 5655--><p class="noindent" >Normal severity messages are printed to <span class="lstinline"></span><span 
class="pcrr7t-">job</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">out</span> and logged by the suite server program:  <!--l. 5658-->
<div class="lstlisting" id="listing-223"><span class="label"><a 
 id="x12-167001r1"></a></span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">message</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">--</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">CYLC_SUITE_NAME</span><span 
class="pcrr7t-">}</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">CYLC_TASK_JOB</span><span 
class="pcrr7t-">}</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">\</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-167002r2"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">Hello</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">from</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">CYLC_TASK_ID</span><span 
class="pcrr7t-">}</span><span 
class="pcrr7t-">"</span>
</div>
<!--l. 5663--><p class="noindent" >CUSTOM severity messages are printed to <span class="lstinline"></span><span 
class="pcrr7t-">job</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">out</span>, logged by the suite server program, and can be used to trigger
<span 
class="cmti-10">custom </span>event handlers:  <!--l. 5666-->
<div class="lstlisting" id="listing-224"><span class="label"><a 
 id="x12-167003r1"></a></span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">message</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">--</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">CYLC_SUITE_NAME</span><span 
class="pcrr7t-">}</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">CYLC_TASK_JOB</span><span 
class="pcrr7t-">}</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">\</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-167004r2"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">CUSTOM</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">data</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">available</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">for</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">CYLC_TASK_CYCLE_POINT</span><span 
class="pcrr7t-">}</span><span 
class="pcrr7t-">"</span>
</div>
<!--l. 5670--><p class="noindent" >Custom severity messages and event handlers can be used to signal special events that are neither routine
information or an error condition, such as production of a particular data file. Task output messages, used for
triggering other tasks, can also be sent with custom severity if need be.
<!--l. 5675--><p class="noindent" >WARNING severity messages are printed to <span class="lstinline"></span><span 
class="pcrr7t-">job</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">err</span>, logged by the suite server program, and can be passed to
<span 
class="cmti-10">warning </span>event handlers: <!--l. 5677-->
<div class="lstlisting" id="listing-225"><span class="label"><a 
 id="x12-167005r1"></a></span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">message</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">--</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">CYLC_SUITE_NAME</span><span 
class="pcrr7t-">}</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">CYLC_TASK_JOB</span><span 
class="pcrr7t-">}</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">\</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-167006r2"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">WARNING</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">Uh</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">oh</span><span 
class="pcrr7t-">,</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">something</span><span 
class="pcrr7t-">'</span><span 
class="pcrr7t-">s</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">not</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">right</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">here</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">"</span>
</div>
<!--l. 5682--><p class="noindent" >CRITICAL severity messages are printed to <span class="lstinline"></span><span 
class="pcrr7t-">job</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">err</span>, logged by the suite server program, and can be passed to
<span 
class="cmti-10">critical </span>event handlers: <!--l. 5684-->
<div class="lstlisting" id="listing-226"><span class="label"><a 
 id="x12-167007r1"></a></span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">message</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">--</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">CYLC_SUITE_NAME</span><span 
class="pcrr7t-">}</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">CYLC_TASK_JOB</span><span 
class="pcrr7t-">}</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">\</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-167008r2"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">CRITICAL</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">ERROR</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">occurred</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">in</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">process</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">X</span><span 
class="pcrr7t-">!</span><span 
class="pcrr7t-">"</span>
</div>
<!--l. 5689--><p class="noindent" >
<!--l. 5689--><p class="noindent" > <h4 id="10.4" class="subsectionHead"> <span class="titlemark"> <a href="#10.4"> 10.4</a>  <a 
 id="x12-16800010.4"></a>Aborting Job Scripts on Error </span></h4>
<!--l. 5691--><p class="noindent" >Task job scripts use <span class="lstinline"></span><span 
class="pcrb7t-">set</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">x</span> to abort on any error, and trap ERR, EXIT, and SIGTERM to send
task failed messages back to the suite server program before aborting. Other scripts called from job
scripts should therefore abort with standard non-zero exit status on error, to trigger the job script error
trap.
<!--l. 5697--><p class="noindent" >To prevent a command that is expected to generate a non-zero exit status from triggering the exit trap, protect it
with a control statement such as:  <!--l. 5700-->
                                                                                         

                                                                                         
<div class="lstlisting" id="listing-227"><span class="label"><a 
 id="x12-168001r1"></a></span><span 
class="pcrb7t-">if</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">cmp</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">FILE1</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">FILE2</span><span 
class="pcrr7t-">;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrb7t-">then</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-168002r2"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">success</span><span 
class="pcrro7t-">:</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">do</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">stuff</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-168003r3"></a></span><span 
class="pcrb7t-">else</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-168004r4"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">#</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">failure</span><span 
class="pcrro7t-">:</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">do</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">other</span><span 
class="pcrro7t-">&#x00A0;</span><span 
class="pcrro7t-">stuff</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-168005r5"></a></span><span 
class="pcrb7t-">fi</span>
</div>
<!--l. 5708--><p class="noindent" >Task job scripts also use <span class="lstinline"></span><span 
class="pcrb7t-">set</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">u</span> to abort on referencing any undefined variable (useful for picking up typos); and
<span class="lstinline"></span><span 
class="pcrb7t-">set</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">o</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">pipefail</span> to abort if any part of a pipe fails (by default the shell only returns the exit status of the final
command in a pipeline).
<!--l. 5713--><p class="noindent" >
<!--l. 5713--><p class="noindent" > <h4 id="10.4.1" class="subsubsectionHead"><span class="titlemark"> <a href="#10.4.1"> 10.4.1</a>  <a 
 id="x12-16900010.4.1"></a>Custom Failure Messages </span></h4>
<!--l. 5715--><p class="noindent" >Critical events normally warrant aborting a job script rather than just sending a message. As described just
above, <span class="lstinline"></span><span 
class="pcrb7t-">exit</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">1</span> or any failing command not protected by the surrounding scripting will cause a job
script to abort and report failure to the suite server program, potentially triggering a <span 
class="cmti-10">failed </span>task event
handler.
<!--l. 5721--><p class="noindent" >For failures detected by the scripting you could send a critical message back before aborting, potentially triggering a
<span 
class="cmti-10">critical </span>task event handler: <!--l. 5723-->
<div class="lstlisting" id="listing-228"><span class="label"><a 
 id="x12-169001r1"></a></span><span 
class="pcrb7t-">if</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">!</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">bin</span><span 
class="pcrr7t-">/</span><span 
class="pcrb7t-">false</span><span 
class="pcrr7t-">;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrb7t-">then</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-169002r2"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">cylc</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">message</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">--</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">CYLC_SUITE_NAME</span><span 
class="pcrr7t-">}</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">{</span><span 
class="pcrr7t-">CYLC_TASK_JOB</span><span 
class="pcrr7t-">}</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">\</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-169003r3"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">CRITICAL</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">ERROR</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">bin</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">false</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">failed</span><span 
class="pcrr7t-">!</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-169004r4"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrb7t-">exit</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">1</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-169005r5"></a></span><span 
class="pcrb7t-">fi</span>
</div>
<!--l. 5731--><p class="noindent" >To abort a job script with a custom message that can be passed to a <span 
class="cmti-10">failed </span>task event handler, use the built-in
<span class="lstinline"></span><span 
class="pcrr7t-">cylc__job_abort</span> shell function: <!--l. 5734-->
<div class="lstlisting" id="listing-229"><span class="label"><a 
 id="x12-169006r1"></a></span><span 
class="pcrb7t-">if</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">!</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">bin</span><span 
class="pcrr7t-">/</span><span 
class="pcrb7t-">false</span><span 
class="pcrr7t-">;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrb7t-">then</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-169007r2"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">cylc__job_abort</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">ERROR</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">bin</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">false</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">failed</span><span 
class="pcrr7t-">!</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-169008r3"></a></span><span 
class="pcrb7t-">fi</span>
</div>
<!--l. 5740--><p class="noindent" >
<!--l. 5740--><p class="noindent" > <h4 id="10.5" class="subsectionHead"> <span class="titlemark"> <a href="#10.5"> 10.5</a>  <a 
 id="x12-17000010.5"></a>Avoid Detaching Processes </span></h4>
<!--l. 5744--><p class="noindent" >If a task script starts background sub-processes and does not wait on them, or internally submits jobs to a batch
scheduler and then exits immediately, the detached processes will not be visible to cylc and the task will
appear to finish when the top-level script finishes. You will need to modify scripts like this to make
them execute all sub-processes in the foreground (or use the shell <span class="lstinline"></span><span 
class="pcrr7t-">wait</span> command to wait on them
before exiting) and to prevent job submission commands from returning before the job completes
(e.g.&#x00A0;<span class="lstinline"></span><span 
class="pcrr7t-">llsubmit</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">s</span> for Loadleveler, <span class="lstinline"></span><span 
class="pcrr7t-">qsub</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">sync</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">yes</span> for Sun Grid Engine, and <span class="lstinline"></span><span 
class="pcrr7t-">qsub</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">W</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">block</span><span 
class="pcrr7t-">=</span><span 
class="pcrr7t-">true</span> for
PBS).
<!--l. 5755--><p class="noindent" >If this is not possible - perhaps you don&#8217;t have control over the script or can&#8217;t work out how to fix it - one
alternative approach is to use another task to repeatedly poll for the results of the detached processes:
<!--l. 5758-->
<div class="lstlisting" id="listing-230"><span class="label"><a 
 id="x12-170001r1"></a></span><span 
class="pcrr7t-">[</span><span 
class="pcrr7t-">scheduling</span><span 
class="pcrr7t-">]</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-170002r2"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">[[</span><span 
class="pcrr7t-">dependencies</span><span 
class="pcrr7t-">]]</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-170003r3"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">graph</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">model</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=&#x003E;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">checker</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=&#x003E;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">post</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">proc</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-170004r4"></a></span><span 
class="pcrr7t-">[</span><span 
class="pcrr7t-">runtime</span><span 
class="pcrr7t-">]</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-170005r5"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">[[</span><span 
class="pcrr7t-">model</span><span 
class="pcrr7t-">]]</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-170006r6"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">#</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">Uh</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">oh</span><span 
class="pcrr7t-">,</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">this</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">script</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">does</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">an</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">internal</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">job</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">submission</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">to</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">run</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">model</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">exe</span><span 
class="pcrr7t-">:</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-170007r7"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">script</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">run</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">model</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">sh</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-170008r8"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">[[</span><span 
class="pcrr7t-">checker</span><span 
class="pcrr7t-">]]</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-170009r9"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">#</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">Fail</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">and</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">retry</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">every</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">minute</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">(</span><span 
class="pcrr7t-">for</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">10</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">tries</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">at</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">the</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">most</span><span 
class="pcrr7t-">)</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">if</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">model</span><span 
class="pcrr7t-">'</span><span 
class="pcrr7t-">s</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-170010r10"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">#</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">job</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">done</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">indicator</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">file</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">does</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">not</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">exist</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">yet</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-170011r11"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">script</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">[[</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">!</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">-</span><span 
class="pcrr7t-">f</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr8c-">$</span><span 
class="pcrr7t-">RUN_DIR</span><span 
class="pcrr7t-">/</span><span 
class="pcrr7t-">job</span><span 
class="pcrr7t-">.</span><span 
class="pcrr7t-">done</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">]]</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&amp;&amp;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">exit</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">1</span><span 
class="pcrr7t-">"</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-170012r12"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">[[[</span><span 
class="pcrr7t-">job</span><span 
class="pcrr7t-">]]]</span><span 
class="pcrr7t-">&#x00A0;</span><br /><span class="label"><a 
 id="x12-170013r13"></a></span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">execution</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">retry</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">delays</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">=</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">10</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">&#x22C6;</span><span 
class="pcrr7t-">&#x00A0;</span><span 
class="pcrr7t-">PT1M</span>
                                                                                         

                                                                                         
</div>
                                                                                         

                                                                                         
<!--l. 5774--><div class="crosslinks"><p class="noindent">[<a 
href="cug-htmlse11.html" >next</a>] [<a 
href="cug-htmlse9.html" >prev</a>] [<a 
href="cug-htmlse9.html#tailcug-htmlse9.html" >prev-tail</a>] [<a 
href="cug-htmlse10.html" >front</a>] [<a 
href="cug-html.html#cug-htmlse10.html" >up</a>] </p></div>
<!--l. 5774--><p class="noindent" ><a 
 id="tailcug-htmlse10.html"></a>  
</body></html> 
