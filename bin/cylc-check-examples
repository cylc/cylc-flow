#!/bin/bash

set -e

usage() {
    echo ""
    echo "USAGE: cylc [admin] check-examples"
    echo ""
    echo "Check that all cylc example suites validate."
}

if [[ $1 == '-h' ]] || [[ $1 == '--help' ]]; then
    usage
    exit 0
fi

BAD=''
for SUITE in $( find $CYLC_DIR/examples -name suite.rc ); do
    cylc val --no-write $SUITE || BAD="$BAD $SUITE"
done
# chomp list
BAD=${BAD# *}

echo
if [[ -z $BAD ]]; then
    echo 'All suites validate OK'
else
    echo 'ERROR: one or more example suites fail validation:'
    for DIR in $BAD; do
        echo "   $DIR"
    done
    # FAIL!
    exit 1
fi

