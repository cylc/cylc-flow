# foo.3 triggers a new flow at foo.1 and waits for it to catch up and merge.
# bar checks for the expected flow names at each cycle point.
[scheduling]
    cycling mode = integer
    initial cycle point = 1
    final cycle point = 3
    [[graph]]
        P1 = "foo[-P1] => foo => bar"
[runtime]
    [[foo]]
        script = """
            if (( CYLC_TASK_CYCLE_POINT == 3 )); then
                cylc trigger --flow=other ${CYLC_WORKFLOW_NAME} foo.1
                cylc__job__poll_grep_workflow_log 'Merged flows'
            fi
        """
    [[bar]]
        script = """
            if [[ $CYLC_TASK_JOB == *01 ]]; then
                # job(02)
                if (( CYLC_TASK_CYCLE_POINT == 3 )); then
                    test $CYLC_TASK_FLOWS == "original,other"
                else
                    test $CYLC_TASK_FLOWS == "original"
                fi
            else
                # job(02)
                test $CYLC_TASK_FLOWS == "other"
            fi
        """
