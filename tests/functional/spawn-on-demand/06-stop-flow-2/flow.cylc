# Check that a specified flow can be stopped without affecting the main flow.
# Here baz triggers a new flow then waits for the second baz to finish.
# Meanwhile the second bar stops its own flow. So order events should be:
# 1.  foo => bar => baz (flow a)
# 2.  foo => bar (flow b)
# 3.  qux (flow a)
[scheduler]
    allow implicit tasks = True
[scheduling]
    [[graph]]
        R1 = "foo => bar => baz => qux"
[runtime]
    [[bar]]
         script = """
if (( CYLC_TASK_SUBMIT_NUMBER == 2 )); then
   cylc stop --flow=other ${CYLC_WORKFLOW_NAME}
   cylc__job__poll_grep_workflow_log "Command succeeded: stop"
fi
         """
    [[baz]]
         script = """
if (( CYLC_TASK_SUBMIT_NUMBER == 1 )); then
   cylc trigger --flow=other ${CYLC_WORKFLOW_NAME} foo.1
   cylc__job__poll_grep_workflow_log -E "bar\.1 running job:02.* => succeeded"
fi
         """
